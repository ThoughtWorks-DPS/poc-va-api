version: "3.2"
services:
  api:
    container_name: "poc-va-api"
    image: docker.pkg.github.com/thoughtworks-dps/poc-va-api/poc-va-api:latest
    ports:
      - "5000:5000"
  integration-test:
    container_name: "integration-test"
    image: "python:3.8.6-slim"
    depends_on:
      - api
    network_mode: host
    volumes:
      - .:/app
    working_dir: /app
    command: >
      bash -c "pip3 install -r requirements.txt && pytest test/integration"